use metaverse_messages::{
    packet::{packet::Packet, packet::PacketData, packet_types::PacketType},
    udp::object::object_update::ObjectUpdate,
};
use uuid::{uuid, Uuid};
const PACKET: [u8; 169] = [
    192, 0, 3, 4, 0, 1, 12, 0, 1, 232, 3, 0, 2, 232, 3, 0, 1, 255, 255, 1, 246, 81, 208, 22, 0, 1,
    157, 193, 139, 177, 4, 79, 76, 104, 144, 107, 44, 182, 8, 178, 225, 151, 0, 4, 47, 4, 0, 1,
    102, 102, 230, 62, 154, 153, 25, 63, 56, 21, 219, 63, 76, 0, 14, 128, 63, 94, 43, 0, 1, 67,
    216, 1, 0, 1, 67, 7, 137, 126, 63, 0, 32, 42, 166, 173, 60, 0, 46, 78, 0, 1, 70, 105, 114, 115,
    116, 78, 97, 109, 101, 32, 83, 84, 82, 73, 78, 71, 32, 82, 87, 32, 83, 86, 32, 100, 101, 102,
    97, 117, 108, 116, 10, 76, 97, 115, 116, 78, 97, 109, 101, 32, 83, 84, 82, 73, 78, 71, 32, 82,
    87, 32, 83, 86, 32, 117, 115, 101, 114, 10, 84, 105, 116, 108, 101, 32, 83, 84, 82, 73, 78, 71,
    32, 82, 87, 32, 83, 86, 32, 0, 77,
];

const PACKET2: [u8; 160] = [
    192, 0, 0, 0, 18, 0, 12, 0, 1, 66, 39, 0, 2, 162, 40, 0, 1, 255, 255, 1, 0, 1, 88, 126, 29, 0,
    1, 254, 189, 105, 110, 131, 188, 70, 110, 171, 72, 99, 132, 234, 103, 190, 207, 134, 110, 176,
    52, 9, 3, 0, 1, 59, 168, 95, 64, 59, 168, 95, 64, 51, 55, 191, 63, 60, 78, 11, 16, 192, 97,
    108, 241, 63, 74, 206, 117, 63, 0, 24, 161, 229, 9, 190, 140, 126, 131, 189, 255, 92, 104, 189,
    0, 12, 244, 87, 126, 29, 80, 4, 2, 0, 1, 16, 0, 20, 139, 185, 81, 0, 1, 156, 121, 63, 206, 185,
    185, 252, 31, 157, 217, 131, 66, 101, 155, 250, 66, 6, 175, 106, 234, 76, 211, 138, 78, 48,
    191, 151, 160, 125, 88, 202, 154, 228, 0, 1, 80, 0, 6, 64, 65, 0, 1, 102, 102, 102, 63, 0, 10,
    32, 0, 101,
];

const MORE_PACKET: [u8; 172] = [
    224, 0, 0, 0, 23, 0, 12, 0, 1, 66, 39, 0, 2, 162, 40, 0, 1, 255, 255, 1, 32, 89, 126, 29, 0, 1,
    186, 190, 2, 243, 77, 219, 64, 74, 143, 97, 248, 182, 3, 214, 214, 63, 156, 209, 87, 54, 9, 3,
    0, 2, 192, 188, 60, 0, 1, 38, 148, 63, 224, 226, 160, 63, 60, 57, 180, 236, 66, 213, 88, 2, 67,
    231, 204, 12, 66, 0, 52, 208, 0, 1, 2, 0, 1, 16, 1, 0, 4, 100, 100, 0, 15, 81, 0, 1, 87, 72,
    222, 204, 246, 41, 70, 28, 154, 54, 163, 90, 34, 31, 226, 31, 20, 55, 132, 88, 115, 227, 146,
    70, 41, 165, 172, 251, 125, 184, 162, 66, 22, 0, 1, 128, 128, 128, 0, 4, 128, 63, 0, 3, 128,
    63, 0, 10, 32, 0, 3, 26, 0, 30, 23, 1, 32, 0, 1, 16, 0, 3, 127, 127, 127, 255, 0, 2, 160, 64,
    0, 4, 10, 215, 35, 60, 0, 66,
];

const PACKET_3: [u8; 258] = [
    224, 0, 0, 0, 21, 0, 12, 0, 1, 52, 8, 0, 2, 52, 8, 0, 1, 255, 255, 1, 65, 192, 70, 25, 2, 162,
    30, 73, 173, 92, 155, 71, 74, 150, 214, 34, 109, 181, 180, 188, 94, 220, 176, 44, 200, 9, 3, 0,
    1, 250, 244, 5, 61, 250, 244, 5, 61, 136, 180, 218, 59, 60, 177, 195, 119, 187, 79, 14, 153,
    188, 162, 190, 155, 61, 0, 24, 255, 255, 255, 62, 3, 0, 2, 191, 255, 255, 255, 190, 0, 12, 54,
    192, 70, 25, 124, 13, 2, 16, 16, 0, 5, 100, 150, 0, 9, 212, 48, 0, 2, 108, 107, 122, 0, 1, 141,
    205, 74, 72, 45, 55, 73, 9, 159, 120, 247, 169, 235, 78, 249, 3, 2, 87, 72, 222, 204, 246, 41,
    70, 28, 154, 54, 163, 90, 34, 31, 226, 31, 1, 150, 93, 254, 188, 128, 28, 78, 242, 169, 134,
    178, 89, 160, 15, 245, 20, 0, 1, 129, 36, 0, 2, 2, 255, 0, 1, 255, 0, 1, 1, 129, 36, 0, 1, 255,
    0, 1, 180, 218, 132, 65, 3, 0, 2, 128, 63, 0, 1, 122, 50, 130, 65, 3, 0, 2, 128, 63, 0, 11, 1,
    32, 0, 1, 2, 3, 0, 21, 16, 3, 0, 1, 5, 8, 0, 6, 32, 66, 0, 2, 240, 65, 0, 11, 24, 1, 48, 0, 1,
    17, 0, 3, 5, 248, 79, 21, 133, 101, 68, 193, 181, 187, 238, 98, 122, 232, 45, 134, 5, 0, 66,
];

const ATTACH_ITEM: [u8; 1467] = [
    0, 232, 3, 0, 0, 232, 3, 0, 255, 255, 4, 83, 125, 142, 43, 16, 12, 228, 98, 28, 172, 63, 75, 4,
    154, 181, 84, 133, 77, 86, 164, 206, 16, 115, 255, 130, 9, 3, 0, 160, 122, 49, 62, 220, 237,
    186, 62, 143, 15, 112, 62, 60, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 82, 125, 142, 43, 60, 9, 2, 16, 32, 0, 0, 0, 0, 0, 100, 150, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 202, 64, 227, 239, 98, 57, 73, 170, 167, 226, 62, 39,
    208, 58, 10, 173, 0, 0, 0, 0, 0, 0, 0, 0, 128, 63, 0, 0, 0, 128, 63, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 63, 0, 65, 116, 116,
    97, 99, 104, 73, 116, 101, 109, 73, 68, 32, 83, 84, 82, 73, 78, 71, 32, 82, 87, 32, 83, 86, 32,
    52, 53, 48, 50, 98, 49, 48, 48, 45, 55, 98, 55, 97, 45, 52, 100, 50, 53, 45, 97, 54, 52, 55,
    45, 48, 99, 48, 52, 52, 55, 50, 97, 50, 57, 55, 51, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 1, 48, 0,
    17, 0, 0, 0, 90, 201, 17, 137, 67, 164, 76, 0, 151, 179, 186, 218, 176, 139, 85, 30, 5, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    84, 125, 142, 43, 32, 31, 227, 3, 144, 254, 219, 78, 147, 147, 116, 76, 118, 148, 77, 110, 50,
    106, 138, 255, 130, 9, 3, 0, 6, 173, 189, 62, 63, 21, 208, 62, 84, 242, 192, 62, 60, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 82, 125, 142, 43,
    60, 9, 2, 16, 32, 0, 0, 0, 0, 0, 100, 150, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0,
    13, 60, 210, 243, 202, 182, 69, 101, 132, 94, 233, 107, 174, 127, 56, 154, 0, 0, 0, 0, 0, 0, 0,
    0, 128, 63, 0, 0, 0, 128, 63, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 63, 0, 65, 116, 116, 97, 99, 104, 73, 116, 101, 109, 73,
    68, 32, 83, 84, 82, 73, 78, 71, 32, 82, 87, 32, 83, 86, 32, 55, 101, 48, 99, 102, 51, 53, 48,
    45, 55, 50, 102, 48, 45, 52, 97, 55, 98, 45, 57, 54, 56, 102, 45, 98, 50, 49, 53, 53, 101, 100,
    53, 100, 49, 101, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 1, 48, 0, 17, 0, 0, 0, 68, 163, 246,
    88, 191, 71, 71, 103, 132, 80, 108, 144, 66, 239, 172, 95, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 85, 125, 142, 43, 97, 157,
    166, 40, 75, 41, 132, 69, 65, 131, 102, 212, 45, 114, 103, 151, 200, 209, 152, 255, 130, 9, 3,
    0, 151, 155, 93, 62, 222, 220, 148, 62, 22, 244, 35, 63, 60, 0, 0, 32, 176, 0, 0, 128, 177, 0,
    81, 113, 62, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 82, 125, 142, 43, 60, 9, 2, 16,
    32, 0, 0, 0, 0, 0, 100, 150, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 202, 125, 145,
    220, 4, 205, 78, 133, 182, 41, 198, 241, 94, 170, 239, 87, 0, 0, 0, 0, 0, 0, 0, 0, 128, 63, 0,
    0, 0, 128, 63, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 63, 0, 65, 116, 116, 97, 99, 104, 73, 116, 101, 109, 73, 68, 32, 83, 84,
    82, 73, 78, 71, 32, 82, 87, 32, 83, 86, 32, 51, 54, 98, 54, 102, 102, 49, 57, 45, 97, 48, 54,
    55, 45, 52, 99, 98, 49, 45, 97, 53, 99, 51, 45, 102, 52, 57, 97, 54, 97, 98, 100, 55, 50, 51,
    48, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 1, 48, 0, 17, 0, 0, 0, 145, 240, 35, 47, 233, 225, 69,
    208, 139, 136, 221, 240, 26, 113, 95, 191, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 125, 142, 43, 80, 241, 203, 237, 189,
    206, 77, 64, 249, 170, 204, 54, 214, 122, 83, 68, 147, 221, 167, 255, 130, 9, 3, 0, 14, 16, 67,
    62, 54, 181, 139, 61, 240, 210, 193, 61, 60, 0, 0, 128, 177, 246, 51, 94, 62, 0, 0, 0, 48, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 82, 125, 142, 43, 60, 9, 2, 16, 32, 0, 0, 0, 0, 0,
    100, 150, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 160, 199, 116, 232, 230, 237, 67,
    177, 133, 99, 212, 45, 56, 25, 47, 232, 0, 0, 0, 0, 0, 0, 0, 0, 128, 63, 0, 0, 0, 128, 63, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 63, 0, 65, 116, 116, 97, 99, 104, 73, 116, 101, 109, 73, 68, 32, 83, 84, 82, 73, 78, 71, 32,
    82, 87, 32, 83, 86, 32, 102, 101, 102, 49, 98, 50, 51, 50, 45, 53, 55, 98, 51, 45, 52, 97, 100,
    102, 45, 57, 102, 52, 100, 45, 56, 98, 52, 51, 51, 102, 101, 53, 101, 55, 56, 53, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 24, 1, 48, 0, 17, 0, 0, 0, 126, 109, 61, 0, 106, 216, 64, 65, 168, 9, 127,
    218, 15, 196, 164, 251, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
];

const NON_ATTACH: [u8; 312] = [
    0, 232, 3, 0, 0, 232, 3, 0, 255, 255, 1, 91, 125, 142, 43, 80, 105, 119, 196, 91, 88, 167, 66,
    72, 188, 179, 187, 159, 248, 10, 141, 250, 95, 174, 255, 130, 9, 3, 0, 241, 102, 202, 61, 96,
    219, 32, 62, 72, 65, 209, 61, 60, 0, 214, 6, 63, 0, 240, 159, 188, 64, 177, 183, 62, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 125, 142, 43, 60, 9, 2, 16, 32, 0, 0, 0, 0, 0, 100,
    150, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 160, 199, 116, 232, 230, 237, 67, 177,
    133, 99, 212, 45, 56, 25, 47, 232, 0, 0, 0, 0, 0, 0, 0, 0, 128, 63, 0, 0, 0, 128, 63, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 1, 48, 0, 17, 0, 0, 0, 144, 67, 99, 71, 161, 95, 66, 183,
    157, 0, 227, 50, 196, 166, 32, 214, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
];

const DEFAULT_USER_ID: Uuid = uuid!("9dc18bb1044f4c68906b2cb608b2e197");
const TEST_FULL_ID: Uuid = uuid!("febd696e-83bc-466e-ab48-6384ea67becf");

#[test]
pub fn test_object_update() {
    let object_update = Packet::from_bytes(&PACKET).unwrap();
    match object_update.body {
        PacketType::ObjectUpdate(object) => {
            assert_eq!(object.full_id, DEFAULT_USER_ID)
        }
        _ => assert!(false),
    }
    let object_update = Packet::from_bytes(&PACKET2).unwrap();
    match object_update.body {
        PacketType::ObjectUpdate(object) => {
            assert_eq!(object.full_id, TEST_FULL_ID)
        }
        _ => assert!(false),
    }
    let object_update = ObjectUpdate::from_bytes(&ATTACH_ITEM).unwrap();
    println!("{:?}", object_update);
    let object_update = ObjectUpdate::from_bytes(&NON_ATTACH).unwrap();
    println!("{:?}", object_update);
}

#[test]
// this test WILL FAIL. this is a known bug. This test is for debugging it.
// the issue is related to the NameValue being read as 4099 bytes long. this is of course not the
// right size.
pub fn test_failing_object() {
    let object_update = Packet::from_bytes(&PACKET_3).unwrap();
    match object_update.body {
        PacketType::ObjectUpdate(object) => {
            assert_eq!(
                object.full_id,
                uuid!("a21e49ad-5c9b-474a-96d6-226db5b4bc5e")
            )
        }
        _ => assert!(false),
    }
}
